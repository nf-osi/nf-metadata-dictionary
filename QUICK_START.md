# Quick Start: LinkML Rules Approach

## What We Built

A **LinkML rules-based auto-fill system** for animal model metadata, replacing the enum/mapping approach from PR #768.

```
User selects:  "B6.129(Cg)-Nf1tm1Par/J"
              â†“
System auto-fills:
              âœ“ species = "Mus musculus"
              âœ“ genotype = "C57BL/6"
              âœ“ backgroundStrain = "C57BL/6"
              âœ“ RRID = "rrid:IMSR_JAX:017640"
              âœ“ + 5 more fields
```

## Files Created

```
ğŸ“ nf-metadata-dictionary/
â”œâ”€â”€ ğŸ“„ modules/Template/
â”‚   â””â”€â”€ AnimalIndividualTemplate.yaml â† 123 rules, 2,653 lines
â”œâ”€â”€ ğŸ“„ scripts/
â”‚   â”œâ”€â”€ generate_animal_template_with_rules.py â† Generates YAML from DB
â”‚   â””â”€â”€ test_linkml_rules.py â† Validates and tests
â””â”€â”€ ğŸ“„ Documentation/
    â”œâ”€â”€ LINKML_RULES_APPROACH.md â† Full explanation
    â”œâ”€â”€ REVISION_SUMMARY.md â† Summary of changes
    â””â”€â”€ QUICK_START.md â† This file
```

## How to Use

### 1. Test the YAML (Already Generated)

```bash
python scripts/test_linkml_rules.py
```

**Output:**
```
âœ… YAML structure is valid
ğŸ“Š 123 rules, 22 slots
ğŸ“ Example rules and lookups
âœ… All tests passed!
```

### 2. Regenerate YAML (When Database Updates)

```bash
python scripts/generate_animal_template_with_rules.py
```

### 3. Generate JSON Schema (Requires LinkML)

```bash
# Install dependencies
pip install linkml
brew install yq  # or apt-get install yq

# Build merged LinkML schema
make NF.yaml

# Generate JSON schema
python utils/gen-json-schema-class.py \
  --class AnimalIndividualTemplate \
  --skip-validation
```

### 4. Test with Synapse

Upload `registered-json-schemas/AnimalIndividualTemplate.json` to Synapse and test:
- Does it validate rules?
- Does it auto-fill fields?
- Is performance acceptable?

## Example Rule

```yaml
- preconditions:
    slot_conditions:
      modelSystemName:
        any_of:
          - equals_string: "B6.129(Cg)-Nf1tm1Par/J (rrid:IMSR_JAX:017640)"
  postconditions:
    slot_conditions:
      species:
        equals_string: "Mus musculus"
      genotype:
        equals_string: "C57BL/6"
      backgroundStrain:
        equals_string: "C57BL/6"
      RRID:
        equals_string: "rrid:IMSR_JAX:017640"
      modelSystemType:
        equals_string: "animal"
      geneticModification:
        equals_string: "Neurofibromatosis type 1"
      manifestation:
        equals_string: "Optic Nerve Glioma"
      institution:
        equals_string: "Memorial Sloan-Kettering Cancer Center"
      description:
        equals_string: "[From JAX]: These mice possess loxP sites..."
  description: "Auto-fill info for B6.129(Cg)-Nf1tm1Par/J mouse model"
```

## Coverage Statistics

| Field | Coverage | Count |
|-------|----------|-------|
| species | 100% | 123/123 |
| organism | 100% | 123/123 |
| modelSystemType | 100% | 123/123 |
| geneticModification | 100% | 123/123 |
| genotype | 59.3% | 73/123 |
| backgroundStrain | 59.3% | 73/123 |
| description | 58.5% | 72/123 |
| institution | 41.5% | 51/123 |
| manifestation | 21.1% | 26/123 |
| RRID | 7.3% | 9/123 |

## Key Decisions

### âœ… What We Did

1. **Used LinkML rules** (native feature)
2. **One YAML file** (single source of truth)
3. **Auto-generated** from tools database
4. **123 rules** (one per animal model)
5. **8-10 fields** auto-filled per model

### â“ What Needs Testing

1. **Synapse compatibility** - Do rules work in Synapse?
2. **Performance** - Is 2,653 lines too large?
3. **Scalability** - Can this handle 1,000+ models?

### ğŸ”„ If This Doesn't Work

1. Return to PR #768 enum/mapping approach
2. Or explore hybrid solutions
3. Or request Synapse database integration

## Workflow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Tools Database (syn51730943)                             â”‚
â”‚    â†’ 123 animal models with metadata                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Mappings File (animal_models_mappings.json)              â”‚
â”‚    â†’ Generated by generate_tool_schemas_from_view.py        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Generation Script (generate_animal_template_with_rules.py)â”‚
â”‚    â†’ Reads mappings                                          â”‚
â”‚    â†’ Creates 123 LinkML rules                                â”‚
â”‚    â†’ Writes AnimalIndividualTemplate.yaml                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LinkML Schema (AnimalIndividualTemplate.yaml)            â”‚
â”‚    â†’ 123 rules with preconditions/postconditions            â”‚
â”‚    â†’ 22 slots defined                                        â”‚
â”‚    â†’ 2,653 lines                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. JSON Schema (AnimalIndividualTemplate.json)              â”‚
â”‚    â†’ Generated via LinkML tooling                            â”‚
â”‚    â†’ Ready for Synapse upload                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Synapse Testing                                           â”‚
â”‚    â†’ Upload schema                                           â”‚
â”‚    â†’ Test validation                                         â”‚
â”‚    â†’ Test auto-fill                                          â”‚
â”‚    â†’ Measure performance                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Read More

- **Full explanation:** `LINKML_RULES_APPROACH.md`
- **Summary:** `REVISION_SUMMARY.md`
- **LinkML Rules docs:** https://linkml.io/linkml/schemas/advanced.html#rules

## Quick Commands

```bash
# Validate YAML
python scripts/test_linkml_rules.py

# Regenerate YAML
python scripts/generate_animal_template_with_rules.py

# Generate JSON schema (requires LinkML + yq)
make NF.yaml
python utils/gen-json-schema-class.py --class AnimalIndividualTemplate
```

## What's Different from PR #768?

| PR #768 | This Approach |
|---------|---------------|
| 12+ generated files | 1 YAML file |
| Separate enums + mappings | Integrated rules |
| Custom DCA integration | Native LinkML |
| Complex to maintain | Simple script |
| Good for 1,000+ models | Best for <200 models |
